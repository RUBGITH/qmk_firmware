os: linux
dist: trusty
sudo: required
group: edge
language: c
branches:
  except:
    - /^.*-automated-build$/
    - /^[0-9]+\.[0-9]+\.[0-9]+/
before_install:
  - wget http://ww1.microchip.com/downloads/en/DeviceDoc/avr8-gnu-toolchain-3.5.4.1709-linux.any.x86_64.tar.gz || wget http://qmk.fm/avr8-gnu-toolchain-3.5.4.1709-linux.any.x86_64.tar.gz
install:
  - tar -zxf avr8-gnu-toolchain-3.5.4.1709-linux.any.x86_64.tar.gz
  - export PATH="$PATH:$TRAVIS_BUILD_DIR/avr8-gnu-toolchain-linux_x86_64/bin"
  - npm install -g moxygen
before_script:
  - avr-gcc --version
script:
- make dz60:weeheavy AUTOGEN=false
addons:
  apt:
    packages:
    - dfu-programmer
    - pandoc
    - gcc-arm-none-eabi
    - binutils-arm-none-eabi
    - libnewlib-arm-none-eabi
    - diffutils
    - dos2unix
    - doxygen
before_deploy:
  - git config --local user.name "weeheavy QMK bot"
  - git config --local user.email "nothing@example.org"
  - git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"
deploy:
  provider: releases
  api_key:
    secure: "mw60kONVByeSfO5l/fEn29OCkapVJyre2GBk4KR6l656lbHe50n7dcy3lxqOhUv7FzpKtGQEHMeLuoloQdFbiJSsb3Sxy6XuUOfhgSyBVRTKx9ITsw+7ROj/ZqeBcsdk6Rz6Mpt1nDTjLYCiYjox6bjSvaT43htSQ3Bt6fK0/IrZSG+L3+Ew2ONdkS+BrRu2F/Jb3doNqZ/MWtkxPKOz1cwXJnPSvUw7tJeB4YdteZ032xTYoYLbS42K7LJT+58nfATIzqOzanqHhOMjb+3ZsunNR0veS83h/nc+WfxOz09D3s5ZDvvEpZ7gdzJD+gLQ9TXnYy4yjZsMmqCe64ozQ3h2b52ggAIxW42XVwcg+md+xK0CK+SON8Gghvy4TO4SHpVKTSeJBmpG6H0PuEDTrR5auqB39M/crAcEfJMc6c6GvDtHdL1C0Wamb9ZFRRaW65XcH6EGaDdbJCyto5tLVnZ/r49DaRRxj6T2LrDbxTSy6j77q/OMWEhRxHuvELoXD/JNf3jrBq/YNqYC6D+3BMjZV6wbb5cC+ps1fTUPwG03ZTuv2Evv+4IeBg83fHNyjOMt6EmMvIo8Fizd4mxEeMsMqUGg686O44a9ptFXP5AoG44U5HlKQUIngYaDL/lQ3XRUT5JTX3IC92Oiwxt+Zmtnv9cdsk0yJPI6fTfkuNk="
  file: dz60_weeheavy.hex
  skip_cleanup: true
